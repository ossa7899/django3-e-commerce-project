{% extends "store/main.html" %}

{% block content %}
    <div class="row justify-content-center mt-5">
        <div class="col-md-5">
            <h2>Sign Up</h2>
        </div>
    </div>
    <div class="row justify-content-center mt-5">
        <div class="col-md-5">
            {% if error %}
                <div class="alert alert-danger" role="alert">
                    {{ error }}
                </div>
            {% endif %}
            <form method="POST">
                {% csrf_token %}
                <div class="form-group">
                    <label for="username">Username(email)</label>
                    <input type="text" name="username" class="form-control" id="username" aria-describedby="usernameHelp">
                    <small id="usernameHelp" class="form-text text-muted">Your username(eamil) must be unique. We'll let you know if someone has taken it already.</small>
                </div>
                <div class="form-group">
                    <label for="password1">Password</label>
                    <input type="password" name="password1" class="form-control" id="password1">
                </div>
                <div class="form-group">
                    <label for="password2">Confirm Password</label>
                    <input type="password" name="password2" class="form-control" id="password2">
                </div>
                <button id="submit_btn"type="submit" class="btn btn-primary">Sign Up</button>
            </form>
            <hr>
            <div class="text-center">
                Do you already have an account? <a href="{% url 'loginuser' %}">Login here</a>
            </div>
        </div>
    </div>
<script type="text/javascript">
    console.log("{{ username }}")
    console.log("{{ password1 }}")
    var username_eamil = '{{ username }}'
    var password = '{{ password1 }}'
    var form = document.getElementById('form')
    form.addEventListener('submit', function (e) {
        e.preventDefault()
        console.log('Form of signup submitted..')
        })
    document.getElementById('submit_btn').addEventListener('click', function (e) {
        submitFormData()
    })

    function submitFormData() {
        console.log(username_eamil)
        console.log(password)
        console.log("Sign up button clicked")

        var userFormData = {
            'username_eamil': username_eamil,
            'password': password,
        }

        var url = '/sign_up/'

        fetch(url, {
            method: 'POST',
            headers: {
                'content-Type': 'application/json',
                'X-CSRFToken': csrftoken,
            },
            body: JSON.stringify({'form': userFormData})
        })

            .then((response) => response.json())
            .then((data) => {
                console.log('Success', data);
                alert('Signup  Complete');

                window.location.href = "{% url 'store' %}"
            })
    }


</script>
{% endblock %}
